<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>방 꾸미기 V.0.2.71</title>
  <script src="https://apis.google.com/js/api.js"></script>
  <script>
    let gapiLoaded = false;  // API 로딩 상태 추적

    // 1. Google Sheets API 로딩 및 인증
    function start() {
      gapi.client.init({
        'apiKey': 'AIzaSyBYMvVkhdniX7glIF42vV6BdPzRwL0AJJQ',  // 발급받은 API 키
        'clientId': '710863003277-ir6c0k7hl1rstsh6bb3pkkj8ddij9hih.apps.googleusercontent.com',  // OAuth 클라이언트 ID
        'scope': 'https://www.googleapis.com/auth/spreadsheets.readonly',
      }).then(function() {
        gapiLoaded = true;  // API 로드 완료
        console.log("Google API 클라이언트가 로드되었습니다.");
      }).catch(function(error) {
        console.error('Google API 로드 실패:', error);
      });
    }

    // 2. API 클라이언트 로드
    gapi.load('client:auth2', start);

    // 3. 로그인 함수
    function login() {
      if (!gapiLoaded) {
        alert('Google API가 로드되지 않았습니다!');
        return;
      }

      const inputId = document.getElementById('id').value;
      const inputPassword = document.getElementById('password').value;

      gapi.client.sheets.spreadsheets.values.get({
        spreadsheetId: '1xUDw_vkG2aS5KF0F50gGpSDgRMmdBZ2_pQc27D39_qQ',
        range: '룸!A2:F10',
      }).then(function(response) {
        const rows = response.result.values || [];
        let isValidUser = false;

        for (let row of rows) {
          const [storedId, storedPassword] = row;
          if (inputId === storedId && inputPassword === storedPassword) {
            isValidUser = true;
            break;
          }
        }

        if (isValidUser) {
          alert('✅ 로그인 성공!');
          window.location.href = 'room.html';
        } else {
          alert('❌ 로그인 실패! ID 또는 Password가 틀렸습니다.');
        }
      }).catch(function(error) {
        console.error('스프레드시트 접근 오류:', error);
      });
    }
  </script>
